PREFIX=@prefix@

.PHONY: test 

default:

install:
	@mkdir -p $(PREFIX)
	@for dir in test;\
	do\
          tar cf - `find $$dir -type f -print -o -type l -print | grep -v CVS ; ` | ( cd $(PREFIX); tar xf - ) ;\
	done
	cp Makefile $(PREFIX)/test

distbin:
	mkdir -p @destdir@/@glite_prefix@
	env PREFIX=@destdir@/@glite_prefix@ make install

distclean: 
	rm -rf Makefile opt configure config.* *~ aclocal.m4 autom4te.cache reports opt install-sh  ltmain.sh  missing  mkinstalldirs

test: test-cert test-new_vo test-user_tests test-performance test-gapi
	echo "Tests finished"

test-cert:
	@echo "Testing create certificates"
	[ -d test ] && cd test ; ./Install.sh -create_cert

test-new_vo:
	@echo "Testing new_vo"
	[ -d test ] && cd test ; ./Install.sh -new_vo

test-user_tests:
	@echo "Running user tests"
	[ -d test ] && cd test ; ./Install.sh -user_tests -no_break -expected catalogue/022,user_basic/010,20,142,user_basic/015,job_automatic/024

test-performance:
	@echo "Running the performance tests"
	[ -d test ] && cd test ; ./Install.sh -performance_tests -apmon

test-gapi:
	@echo "Testing gapi"
	[ -d test ] && cd test ; ./Install.sh -gapi_tests -no_break -expected gapi/500,gapi/632,gapi/633,gapi/631,gapi/501,gapi/502,gapi/600,gapi/610,gapi/601,gapi/602,gapi/603,gapi/610,gapi/620,gapi/621,gapi/622,gapi/623,gapi/624,gapi/630,gapi/600

